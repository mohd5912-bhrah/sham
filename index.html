<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, maximum-scale=1">
<title>Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©ğŸ”</title>

<style>
body{
  font-family: Tahoma, sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:15px;
}
h2{margin:0 0 10px 0; color:#0c7b93}

/* ===== Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ø§Ø± ===== */
.top-buttons{
  display:flex;
  gap:8px;
  margin-bottom:10px;
}
.top-buttons button{
  flex:1;
  padding:8px;
  border:none;
  border-radius:20px;
  background:#0c7b93;
  color:#fff;
  font-size:14px;
  cursor:pointer;
}
.top-buttons button:hover{background:#095a6b}

.container{display:flex; flex-wrap:wrap; gap:15px;}
.box{
  background:#fff;
  border-radius:10px;
  padding:10px;
  flex:1;
  min-width:280px;
  box-shadow:0 2px 6px rgba(0,0,0,.06);
}

#cats,#authors,#books{
  max-height:70vh;
  overflow-y:auto;
}

.search{
  width:80%;
  padding:7px;
  margin-bottom:10px;
  border-radius:6px;
  border:1px solid #ccc;
}

.item{
  padding:6px;
  border-bottom:1px solid #eee;
  cursor:pointer;
}
.item:hover{background:#f0f7fa}

.badge{
  background:#0c7b93;
  color:#fff;
  font-size:12px;
  padding:2px 6px;
  border-radius:10px;
}

/* ===== Ø§Ù„ÙƒØªØ¨ ===== */
.book-card{
  background:#fff;
  border-radius:12px;
  margin-bottom:12px;
  overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.book-header{
  padding:10px;
  cursor:pointer;
  font-weight:bold;
  color:#0c7b93;
  display:flex;
  align-items:center;
  gap:8px;                 /* Ù…Ø³Ø§ÙØ© Ø¨Ø³ÙŠØ·Ø© ÙÙ‚Ø· */
  background:#e8f2f5;
}
.book-header .title{
  flex:1;
}

.book-info{
  padding:10px;
  display:none;
  background:#fafafa;
  white-space:pre-line;
}
.toggle-icon.open{transform:rotate(90deg)}
.highlight{background:yellow}
</style>
</head>

<body>

<h2 id="mainTitle">ğŸ“š Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©</h2>

<!-- ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ===== -->
<div class="top-buttons">
  <button onclick="showCats()">ğŸ“‚ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
  <button onclick="showAuthors()">ğŸ‘¤ Ø§Ù„Ù…Ø¤Ù„ÙÙˆÙ†</button>
  <button onclick="showBooks()">ğŸ“š Ø§Ù„ÙƒØªØ¨</button>
  <button onclick="showAll()">Ø±Ø¬ÙˆØ¹</button>
</div>

<div class="container">

  <div class="box" id="catsBox">
    <h3>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
    <input class="search" id="catSearch" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…">
    <div id="cats"></div>
  </div>

  <div class="box" id="authorsBox">
    <h3>Ø§Ù„Ù…Ø¤Ù„ÙÙˆÙ†</h3>
    <input class="search" id="authorSearch" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø¤Ù„ÙÙŠÙ†">
    <div id="authors"></div>
  </div>

  <div class="box" style="flex:2" id="booksBox">
    <h3 id="booksTitle">Ø§Ù„ÙƒØªØ¨</h3>
    <input class="search" id="bookSearch" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ÙƒØªØ¨">
    <div id="books"></div>
  </div>

</div>

<script>
let currentCat=null;
let currentAuthor=null;
let data={books:[],categories:[]};

fetch("library.json")
.then(r=>r.json())
.then(j=>{
 data=j;
 document.getElementById("mainTitle").innerHTML=
 `ğŸ“š Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© - <font color=red>${data.books.length}</font> ÙƒØªØ§Ø¨<br><font color=blue>ÙÙ‚Ø· Ø¨Ø­Ø« ÙÙŠ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù…Ø¤Ù„ÙÙŠÙ† ğŸ”</font>`;
 renderCategories(); renderAuthors(); renderBooks();
});

/* ===== Ø¹Ø±Ø¶ ===== */
function showCats(){
 catsBox.style.display="block";
 authorsBox.style.display="none";
 booksBox.style.display="none";
}
function showBooks(){
showAll();
 booksBox.style.display="block";
 catsBox.style.display="none";
 authorsBox.style.display="none";

}
function showAuthors(){
 catsBox.style.display="none";
 authorsBox.style.display="block";
 booksBox.style.display="none";
}
function showAll(){
 catsBox.style.display="block";
 authorsBox.style.display="block";
 booksBox.style.display="block";
 currentCat=null; currentAuthor=null;
 bookSearch.value="";
 renderBooks();
}

/* ===== Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ===== */
function renderCategories(){
 cats.innerHTML="";
 const q=catSearch.value.toLowerCase();
 data.categories.filter(c=>c.name.toLowerCase().includes(q))
 .forEach(c=>{
  const n=data.books.filter(b=>b.category_id==c.id).length;
  const d=document.createElement("div");
  d.className="item";
  d.innerHTML=`${c.name} <span class="badge">${n}</span>`;
  d.onclick=()=>{currentCat=c.id;currentAuthor=null;booksBox.style.display="block";catsBox.style.display="none";authorsBox.style.display="none";renderBooks();}
  cats.appendChild(d);
 });
}

/* ===== Ø§Ù„Ù…Ø¤Ù„ÙÙˆÙ† ===== */
function renderAuthors(){
 authors.innerHTML="";
 const q=authorSearch.value.toLowerCase();
 const map={};
 data.books.forEach(b=>map[b.author]=(map[b.author]||0)+1);
 Object.keys(map).filter(a=>a.toLowerCase().includes(q))
 .forEach(a=>{
  const d=document.createElement("div");
  d.className="item";
  d.innerHTML=`${a} <span class="badge">${map[a]}</span>`;
  d.onclick=()=>{currentAuthor=a;currentCat=null;booksBox.style.display="block";catsBox.style.display="none";authorsBox.style.display="none";renderBooks();}
  authors.appendChild(d);
 });
}

/* ===== Ø§Ù„ÙƒØªØ¨ ===== */
function highlight(t,q){return !q?t:t.replace(new RegExp(q,"gi"),m=>`<span class=highlight>${m}</span>`);}

function renderBooks(){
 books.innerHTML="";
 const q=bookSearch.value.toLowerCase();
 const list=data.books.filter(b=>{
  if(currentCat && b.category_id!=currentCat) return false;
  if(currentAuthor && b.author!=currentAuthor) return false;
  if(!q) return true;
  return b.title.toLowerCase().includes(q);
 });

 const label = bookLabel(list.length);

if(currentCat){
  const cat = data.categories.find(c => c.id === currentCat);
  booksTitle.textContent = `ğŸ“‚ ${cat.name} (${list.length}) ${label}`;
}
else if(currentAuthor){
  booksTitle.textContent = `ğŸ‘¤ ${currentAuthor} (${list.length}) ${label}`;
}
else{
  booksTitle.textContent = `ğŸ“š Ø§Ù„ÙƒØªØ¨ (${list.length}) ${label}`;
}



 list.forEach(b=>{
  const d=document.createElement("div");
  d.className="book-card";
  d.innerHTML=`
   <div class="book-header">
  <span class="title">${highlight(b.title,q)}</span>
  <span class="toggle-icon">â–¶</span>
</div>

   <div class="book-info">âœï¸ ${b.author}\n\n${b.info}</div>`;
  const h=d.querySelector(".book-header");
  const i=d.querySelector(".book-info");
  const ic=d.querySelector(".toggle-icon");
  h.onclick=()=>{i.style.display=i.style.display=="block"?"none":"block";ic.classList.toggle("open");}
  books.appendChild(d);
 });
}

function bookLabel(count){
  if(count === 1) return "ÙƒØªØ§Ø¨ ÙˆØ§Ø­Ø¯";
  if(count === 2) return "ÙƒØªØ§Ø¨Ø§Ù†";
  if(count >= 3 && count <= 9) return "ÙƒØªØ¨";
  return "ÙƒØªØ§Ø¨";
}

/* ===== Ø§Ù„Ø¨Ø­Ø« ===== */
catSearch.oninput=renderCategories;
authorSearch.oninput=renderAuthors;
bookSearch.oninput=renderBooks;

// ===== ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© =====
window.addEventListener('DOMContentLoaded', () => {

  document.getElementById('catSearch').value = '';
  document.getElementById('authorSearch').value = '';
  document.getElementById('bookSearch').value = '';

  currentCat = null;
  currentAuthor = null;
  });


if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js")
    .then(()=>console.log("PWA Ready"))
    .catch(err=>console.error("SW error", err));
}
</script>

</body>
</html>
